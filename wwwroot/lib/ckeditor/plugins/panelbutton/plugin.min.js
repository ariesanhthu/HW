CKEDITOR.plugins.add("panelbutton",{requires:"button",onLoad:function(){function n(t){var e=this._;e.state!=CKEDITOR.TRISTATE_DISABLED&&(this.createPanel(t),e.on?e.panel.hide():e.panel.showBlock(this._.id,this.document.getById(this._.id),4))}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){var e=t.panel||{};delete t.panel,this.base(t),this.document=e.parent&&e.parent.getDocument()||CKEDITOR.document,e.block={attributes:e.attributes},e.toolbarRelated=!0,this.hasArrow="listbox",this.click=n,this._={panelDefinition:e}},statics:{handler:{create:function(t){return new CKEDITOR.ui.panelButton(t)}}},proto:{createPanel:function(e){var t,n,o,a,i,s,d,l=this._;l.panel||(i=this._.panelDefinition,t=this._.panelDefinition.block,n=i.parent||CKEDITOR.document.getBody(),o=CKEDITOR.document.getById(this._.id),i=(a=this._.panel=new CKEDITOR.ui.floatPanel(e,n,i)).addBlock(l.id,t),d=e.getCommand((s=this).command),a.onShow=function(){s.className&&this.element.addClass(s.className+"_panel"),s.setState(CKEDITOR.TRISTATE_ON),o.setAttribute("aria-expanded","true"),l.on=1,s.editorFocus&&e.focus(),s.onOpen&&s.onOpen()},a.onHide=function(t){s.className&&this.element.getFirst().removeClass(s.className+"_panel"),!s.modes&&d?s.setStateFromCommand(d):s.setState(s.modes&&s.modes[e.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),l.on=0,o.setAttribute("aria-expanded","false"),!t&&s.onClose&&s.onClose()},a.onEscape=function(){a.hide(1),s.document.getById(l.id).focus()},this.onBlock&&this.onBlock(a,i),i.onHide=function(){l.on=0,!s.modes&&s.command?s.setStateFromCommand(d):s.setState(CKEDITOR.TRISTATE_OFF)})},setStateFromCommand:function(t){this.setState(t.state)}}})},beforeInit:function(t){t.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}}),CKEDITOR.UI_PANELBUTTON="panelbutton";